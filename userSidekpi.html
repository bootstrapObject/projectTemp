<!doctype html>
<html lang="en">
<!--[if IE 9 ]>
<html  lang="en" class="ie9">
<![endif]-->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <meta charset="UTF-8">
    <title>用户端KPI</title>
    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/form.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/icons.css">
    <link rel="stylesheet" href="css/generics.css">
    <link rel="stylesheet" href="css/bstable/bootstrap-table.css">
    <link rel="stylesheet" href="css/bstable/bootstrap-table-self.css">
</head>
<body>
<header id="header" class="media">
    <a href="" id="menu-toggle"></a>
    <a class="logo pull-left" href="index.html">
        <img src="images/logo.png" alt="logo">
    </a>
    <div class="media-body">
        <div class="media" id="top-menu">
            <div class="pull-left tm-icon">
                <a data-drawer="messages" class="drawer-toggle" href="">
                    <i class="sa-top-message"></i>
                    <span>时间回溯</span>
                </a>
            </div>
            <div class="pull-left tm-icon">
                <a data-drawer="notifications" class="drawer-toggle" href="">
                    <i class="sa-top-updates"></i>
                    <span>帮助</span>
                </a>
            </div>
            <div id="time" class="pull-right">
                <span id="hours"></span>
                :
                <span id="min"></span>
                :
                <span id="sec"></span>
            </div>
            <div class="media-body">
                <input type="text" class="main-search">
            </div>
        </div>
    </div>
</header>
<div class="clearfix"></div>
<section id="main" class="p-relative" role="main">
    <!-- Sidebar -->
    <aside id="sidebar">
        <!-- Side Menu -->
        <ul class="list-unstyled side-menu">
            <li>
                <a class="sa-side-home" href="index.html">
                    <span class="menu-item">首页</span>
                </a>
            </li>
        </ul>
    </aside>
    <!-- Content -->
    <section id="content" class="container">
        <!-- Messages Drawer时间回溯 -->
        <div id="messages" class="tile drawer animated">
            <div class="listview narrow">
                <div class="media">
                    <a href="">时间回溯</a>
                    <span class="drawer-close">&times;</span>
                </div>
                <div class="overflow" style="height: 254px">
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/1.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Nadin Jackson - 2 Hours ago</small><br>
                            <a class="t-overflow" href="">Mauris consectetur urna nec tempor adipiscing. Proin sit amet nisi ligula. Sed eu adipiscing lectus</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/2.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">David Villa - 5 Hours ago</small><br>
                            <a class="t-overflow" href="">Suspendisse in purus ut nibh placerat Cras pulvinar euismod nunc quis gravida. Suspendisse pharetra</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/3.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Harris worgon - On 15/12/2013</small><br>
                            <a class="t-overflow" href="">Maecenas venenatis enim condimentum ultrices fringilla. Nulla eget libero rhoncus, bibendum diam eleifend, vulputate mi. Fusce non nibh pulvinar, ornare turpis id</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/4.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Mitch Bradberry - On 14/12/2013</small><br>
                            <a class="t-overflow" href="">Phasellus interdum felis enim, eu bibendum ipsum tristique vitae. Phasellus feugiat massa orci, sed viverra felis aliquet quis. Curabitur vel blandit odio. Vestibulum sagittis quis sem sit amet tristique.</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/1.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Nadin Jackson - On 15/12/2013</small><br>
                            <a class="t-overflow" href="">Ipsum wintoo consectetur urna nec tempor adipiscing. Proin sit amet nisi ligula. Sed eu adipiscing lectus</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/2.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">David Villa - On 16/12/2013</small><br>
                            <a class="t-overflow" href="">Suspendisse in purus ut nibh placerat Cras pulvinar euismod nunc quis gravida. Suspendisse pharetra</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/3.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Harris worgon - On 17/12/2013</small><br>
                            <a class="t-overflow" href="">Maecenas venenatis enim condimentum ultrices fringilla. Nulla eget libero rhoncus, bibendum diam eleifend, vulputate mi. Fusce non nibh pulvinar, ornare turpis id</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/4.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Mitch Bradberry - On 18/12/2013</small><br>
                            <a class="t-overflow" href="">Phasellus interdum felis enim, eu bibendum ipsum tristique vitae. Phasellus feugiat massa orci, sed viverra felis aliquet quis. Curabitur vel blandit odio. Vestibulum sagittis quis sem sit amet tristique.</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/5.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Wendy Mitchell - On 19/12/2013</small><br>
                            <a class="t-overflow" href="">Integer a eros dapibus, vehicula quam accumsan, tincidunt purus</a>
                        </div>
                    </div>
                </div>
                <div class="media text-center whiter l-100">
                    <a href=""><small>VIEW ALL</small></a>
                </div>
            </div>
        </div>
        <!-- Notification Drawer帮助 -->
        <div id="notifications" class="tile drawer animated">
            <div class="listview narrow">
                <div class="media">
                    <a href="">帮助</a>
                    <span class="drawer-close">&times;</span>
                </div>
                <div class="overflow" style="height: 254px">
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/1.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Nadin Jackson - 2 Hours ago</small><br>
                            <a class="t-overflow" href="">Mauris consectetur urna nec tempor adipiscing. Proin sit amet nisi ligula. Sed eu adipiscing lectus</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/2.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">David Villa - 5 Hours ago</small><br>
                            <a class="t-overflow" href="">Suspendisse in purus ut nibh placerat Cras pulvinar euismod nunc quis gravida. Suspendisse pharetra</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/3.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Harris worgon - On 15/12/2013</small><br>
                            <a class="t-overflow" href="">Maecenas venenatis enim condimentum ultrices fringilla. Nulla eget libero rhoncus, bibendum diam eleifend, vulputate mi. Fusce non nibh pulvinar, ornare turpis id</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/4.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Mitch Bradberry - On 14/12/2013</small><br>
                            <a class="t-overflow" href="">Phasellus interdum felis enim, eu bibendum ipsum tristique vitae. Phasellus feugiat massa orci, sed viverra felis aliquet quis. Curabitur vel blandit odio. Vestibulum sagittis quis sem sit amet tristique.</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/1.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">Nadin Jackson - On 15/12/2013</small><br>
                            <a class="t-overflow" href="">Ipsum wintoo consectetur urna nec tempor adipiscing. Proin sit amet nisi ligula. Sed eu adipiscing lectus</a>
                        </div>
                    </div>
                    <div class="media">
                        <div class="pull-left">
                            <img width="40" src="img/profile-pics/2.jpg" alt="">
                        </div>
                        <div class="media-body">
                            <small class="text-muted">David Villa - On 16/12/2013</small><br>
                            <a class="t-overflow" href="">Suspendisse in purus ut nibh placerat Cras pulvinar euismod nunc quis gravida. Suspendisse pharetra</a>
                        </div>
                    </div>
                </div>
                <div class="media text-center whiter l-100">
                    <a href=""><small>VIEW ALL</small></a>
                </div>
            </div>
        </div>
        <!-- Breadcrumb -->
        <div class="block-area">
       <!--     <div class="table-responsive overflow">
                <table id="table7">
                </table>
            </div>-->
            <div class="table-responsive overflow">
                <div id="guanchapoint">
                    <span class="block-title" style="padding:0px 10px 0px;">观察点KPI</span>
                </div>
                <table id="table7">
                </table>
            </div>
            <div class="table-responsive overflow m-t-15">
                <div id="userduan">
                    <span class="block-title" style="padding:0px 10px 0px;">用户端KPI</span>
                </div>
                <table id="userSidekpi"></table>
                <hr class="whiter m-t-20">
            </div>
            <div class="table-responsive overflow">
                <div id="serverduan">
                    <span class="block-title" style="padding:0px 10px 0px;">服务端KPI</span>
                </div>
                <table id="serverSidekpi"></table>
            </div>
        </div>
    </section>
    <!-- Older IE Message -->
    <!--[if lt IE 9]>
    <div class="ie-block">
        <h1 class="Ops">抱歉！</h1>
        <p>您正在使用一个过时的Internet Explorer版本，升级到以下任何Web浏览器，以便访问该网站的最大功能。 </p>
        <ul class="browsers">
            <li>
                <a href="http://www.google.cn/intl/zh-CN/chrome/browser/desktop/index.html">
                    <img src="img/browsers/chrome.png" alt="">
                    <div>Google Chrome</div>
                </a>
            </li>
            <li>
                <a href="http://www.firefox.com.cn/">
                    <img src="img/browsers/firefox.png" alt="">
                    <div>Mozilla Firefox</div>
                </a>
            </li>
            <li>
                <a href="http://www.oupeng.com/download">
                    <img src="img/browsers/opera.png" alt="">
                    <div>Opera</div>
                </a>
            </li>
            <li>
                <a href="https://www.apple.com/cn/safari/">
                    <img src="img/browsers/safari.png" alt="">
                    <div>Safari</div>
                </a>
            </li>
            <li>
                <a href="https://support.microsoft.com/zh-cn/help/17621/internet-explorer-downloads">
                    <img src="img/browsers/ie.png" alt="">
                    <div>Internet Explorer(New)</div>
                </a>
            </li>
        </ul>
        <p>升级你的浏览器更安全和更快的网络体验。 <br/>感谢你的支持...</p>
    </div>
    <![endif]-->
</section>
</body>
</html>
<!-- jQuery -->
<script src="js/jquery.min.js"></script> <!-- jQuery Library -->
<!-- Bootstrap -->
<script src="js/bootstrap.min.js"></script>
<!-- Bootstrap-table -->
<script src="js/bstable/bootstrap-table.js"></script>
<script src="js/bstable/bootstrap-table-zh-CN.js"></script>
<script src="js/functions.js"></script>
<script src="js/changebgsave.js"></script>
<script src="js/sidebar.js"></script>
<script>
    $(function(){
        var selectRow = window.location.href.split("?")[1].split("&")[0].split("=")[1]-0,
                selectDataId = window.location.href.split("?")[1].split("&")[1].split("=")[1]-0;
        var obPointkpi = {
            clickTableRow:function(tableName,rowId,element,appBusinessId){
                var watchPointId;
                if(!$("#table7 .tabRowClickbg").attr("data-id")){
                    $.ajax({
                        url:"/commonController/getNpmListRrdData.do",
                        type:"post",
                        async:false,
                        data:{"moduleId":10},
                        dataType:"json",
                        success:function(data){
                            watchPointId = data[0].id;
                        }
                    })
                }else {
                    watchPointId = $("#table7 .tabRowClickbg").attr("data-id")
                }
                function updataUser(moduleId,url,watchPointId,appBusinessId){
                    $("#userSidekpi").bootstrapTable("showLoading");
                    $(".fixed-table-loading").css("line-height",$(".fixed-table-loading").height()+"px");
                    $.ajax({
                        url:url,
                        type:"post",
                        data:{
                            "moduleId":moduleId,
                            "watchPointId":watchPointId,
                            "appBusinessId":appBusinessId,
                            "starttime":1505892630,
                            "endtime":1505960881
                        },
                        dataType:"json",
                        success:function(data){
                            $("#userSidekpi").bootstrapTable("hideLoading");
                            $("#userSidekpi").bootstrapTable("load",data);
                        }
                    });
                }
                function updataServer(moduleId,url,watchPointId,appBusinessId){
                    $("#serverSidekpi").bootstrapTable("showLoading");
                    $(".fixed-table-loading").css("line-height",$(".fixed-table-loading").height()+"px");
                    $.ajax({
                        url:url,
                        type:"post",
                        data:{
                            "moduleId":moduleId,
                            "watchPointId":watchPointId,
                            "appBusinessId":appBusinessId,
                            "starttime":1505892630,
                            "endtime":1505960881
                        },
                        dataType:"json",
                        success:function(data){
                            $("#serverSidekpi").bootstrapTable("hideLoading");
                            $("#serverSidekpi").bootstrapTable("load",data);
                        }
                    })
                }
                switch (tableName){
                    case "userSidekpi":
                        $("#"+tableName+" .tabRowClickbg").removeClass("tabRowClickbg");
                        $(element).addClass("tabRowClickbg");
                        updataServer(11,
                                "/commonController/getNpmListRrdDataBySubPath.do",
                                watchPointId,
                                appBusinessId);
                        break;
                    case "serverSidekpi":
                        $("#"+tableName+" .tabRowClickbg").removeClass("tabRowClickbg");
                        $(element).addClass("tabRowClickbg");
                        updataUser(12,
                                "/commonController/getNpmListRrdDataBySubPath.do",
                                watchPointId,
                                appBusinessId);
                        break;
                    default:
                        $(".tabRowClickbg").removeClass("tabRowClickbg").removeAttr("data-id");
                        $(element).addClass("tabRowClickbg").attr("data-id",rowId);
                        updataUser(11,
                                "commonController/getNpmListRrdData.do",
                                rowId
                        );
                        updataServer(12,
                                "commonController/getNpmListRrdData.do",
                                rowId
                        );
                        break;
                }
            },
            modulkpi:function(userColumnurl,toolbartem,modolkpiurl,tableId,watchPointId,moduleId,starttime,endtime){
                $.ajax({
                    url:userColumnurl,
                    type:"post",
                    data:"",
                    dataType:"json",
                    success:function(data){
                        var columnsArry = [];
                        data.forEach(function(title){
                            if(title.columnen!="id"){
                                var colObjet = {
                                    field:title.columnen,
                                    title:title.columnzh+"<span data-columnId='"+title.id+"'></span>",
                                    sortable:true,
                                    visible:title.checked
                                };
                                columnsArry.push(colObjet);
                            }
                        });
                        $(tableId).bootstrapTable({
                            url:modolkpiurl,
                            queryParams:function(params){
                                return {
                                    "moduleId":moduleId,
                                    "watchPointId":watchPointId,
                                    "starttime":starttime,
                                    "endtime":endtime
                                }
                            },
                            toggle:"table",
                            toolbar:toolbartem,
                            pagination:true,
                            showColumns:true,
                            columns:columnsArry,
                            onClickRow:function(e,row){
                                if(tableId=="#table7"){
                                    obPointkpi.clickTableRow(null,e.id,row);
                                }else if(tableId=="#userSidekpi"){
                                    obPointkpi.clickTableRow("userSidekpi",
                                            null,
                                            row,
                                            e.id);
                                }
                            }
                        });
                    }
                });
            },
            clickColumn:function(thisElm,userColumnurl,userColumnUpurl,moduleId){
                thisElm.siblings(".dropdown-menu").find("input[type='checkbox']").on("click",function(){
                    if($(this).attr("checked")){
                        $(this).attr("checked",false);
                        $.ajax({
                            url:"userConfigure/unCheckedUserListColumn.do",
                            type:"post",
                            data:{
                                columnId:$(this).siblings("span").attr("data-columnId")
                            },
                            dataType:"text",
                            success:function(data){
                            }
                        })
                    }else {
                        $(this).attr("checked",true);
                        $.ajax({
                            url:"userConfigure/checkedUserListColumn.do",
                            type:"post",
                            data:{
                                columnId:$(this).siblings("span").attr("data-columnId")
                            },
                            dataType:"text",
                            success:function(data){
                            }
                        })
                    }
                });
            }
        };
        /*-------用户刚刚进入此页面时触发的事件------------------*/
        $.ajax({
            url:"/commonController/getNpmListRrdData.do",
            type:"post",
            data:{
                "moduleId":10
            },
            dataType:"json",
            success:function(data){
                obPointkpi.modulkpi("/watchpointController/getWatchpointUserListColumn.do",
                        "#guanchapoint",
                        "/commonController/getNpmListRrdData.do",
                        "#table7",
                        null,
                        10);//观察点

                obPointkpi.modulkpi("/client/getClientUserListColumn.do",
                        "#userduan",
                        "/commonController/getNpmListRrdData.do",
                        "#userSidekpi",
                        data[0].id,
                        11,
                        1505892630,
                        1505960881,
                        1
                );//用户端
                obPointkpi.modulkpi("/serverManagement/getServerSideUserListColumn.do",
                        "#serverduan",
                        "/commonController/getNpmListRrdData.do",
                        "#serverSidekpi",
                        data[0].id,
                        12,
                        1505892630,
                        1505960881,
                        1
                );//服务端
                setTimeout(function(){
                    $("#table7 tbody tr").eq(0).addClass("tabRowClickbg");
                    if(selectRow>9){
                        $("#userSidekpi").bootstrapTable('selectPage', Math.ceil((selectRow-0+1)/10));
                        $("#userSidekpi tbody tr").each(function(index,element){
                            if($(element).attr("data-index")==selectRow){
                                $(element).addClass("tabRowClickbg");
                            }
                        })
                    }else {
                        $("#userSidekpi tbody tr").eq(selectRow).addClass("tabRowClickbg");
                    }
                },600)
            }
        });
        /*-------------用户操作列的消失隐藏--------------------------*/
        $(document).one('click','button[data-toggle="dropdown"]',function(){
            if($(this).attr("aria-label")=="columns"){
                var idWord = $(this).parents(".columns").prev(".bs-bars").children("div").attr("id"),
                        thisElm = $(this);
                switch (idWord){
                    case "guanchapoint":
                        obPointkpi.clickColumn(thisElm);
                        break;
                    case "userduan":
                        obPointkpi.clickColumn(thisElm);
                        break;
                    case "serverduan":
                        obPointkpi.clickColumn(thisElm);
                        break;
                }
            }
        });
    });
</script>
